<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<body>
  <!-- 유저가 입력하는 form -->
  <form action="/login" method="post" id="loginForm">
    <fieldset>
      <legend class="screen_out">로그인 폼</legend>

      <label for="email">이메일</label>
      <input type="text" id="email" name="email" autofocus autocomplete="off" required />

      <label for="password">비밀번호</label>
      <input type="password" id="password" name="password" autocomplete="off" required />

      <button type="submit">
        <i class="fa fa-sign-in"></i> 로그인
      </button>
    </fieldset>
  </form>

  <!-- 실제 서버로 전송되는 form -->
  <form action="/login" method="post" id="hiddenForm">
    <fieldset>
      <input type="hidden" name="email" />
      <input type="hidden" name="password" />
    </fieldset>
  </form>

  <!-- javascript lib load -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="/resources/js/rsa/jsbn.js"></script>
  <script src="/resources/js/rsa/prng4.js"></script>
  <script src="/resources/js/rsa/rng.js"></script>
  <script src="/resources/js/rsa/rsa.js"></script>

  <!-- 유저 입력 form의 submit event 재정의 -->
  <script>
    var $email = $("#hiddenForm input[name='email']");
    var $password = $("#hiddenForm input[name='password']");

    // Server로부터 받은 공개키 입력
    let rsa;
    rsa = new RSAKey();
    rsa.setPublic("${modulus}", "${exponent}");

    $("#loginForm").submit(function(e) {
      // 실제 유저 입력 form은 event 취소
      // javascript가 작동되지 않는 환경에서는 유저 입력 form이 submit 됨
      // -> Server 측에서 검증되므로 로그인 불가
      e.preventDefault();

      // 아이디/비밀번호 암호화 후 hidden form으로 submit
      var email = $(this).find("#email").val();
      var password = $(this).find("#password").val();
      $email.val(rsa.encrypt(email)); // 아이디 암호화
      $password.val(rsa.encrypt(password)); // 비밀번호 암호화
      $("#hiddenForm").submit();
    });
  </script>
</body>
</html>